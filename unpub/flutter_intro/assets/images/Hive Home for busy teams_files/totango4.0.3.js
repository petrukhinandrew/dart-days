/*! totango-js-tracker 4.0.3 29-06-2020 */
function __totango(a){this.__SDRLog=[],Date.now||(Date.now=function(){return(new Date).valueOf()});var b=function(a,b){if(!a)return null;for(var c=0;c<b.length;++c)if(a[b[c]])return a[b[c]]},c=function(a,b){for(var c in b)for(var d=b[c].keys,e=0;e<d.length;++e)if(a==d[e])return!0;return!1},d=function(a,b){if(!a)return a;for(var c in b)for(var d=b[c].keys,e=0;e<d.length;++e)if(a[d[e]]){var f=a[d[e]];delete a[d[e]],a[c]=f}return a};this.hosts={test:"sdr-test.totango.com",us:"sdr.totango.com",eu:"sdr-eu.totango.com",eu1:"sdr-eu1.totango.com"},this.version=function(){return"4.0.3"},this.setOptions=function(a){if(a){var b=a.mirror_services;if(a=this.merge(a),b&&(a.mirror_services=b),void 0===a.heartbeat_timeout_sec&&(a.heartbeat_timeout_sec=60),void 0===a.heartbeat_idle_timeout_sec&&(a.heartbeat_idle_timeout_sec=60),"undefined"==typeof a.allow_empty_accounts&&(a.allow_empty_accounts=!0),this.allow_empty_accounts=a.allow_empty_accounts,this.service_id=a.service_id||this.service_id,this.region=a.region||this.region,this.mirror_services=a.mirror_services||this.mirror_services,this.heartbeat_timeout_ms=a.disable_heartbeat||a.heartbeat_timeout_sec<30?-1:1e3*a.heartbeat_timeout_sec,this.heartbeat_idle_timeout_ms=1e3*a.heartbeat_idle_timeout_sec,this.username=a.username||this.username,this.module=a.module,this.account=this.account||{},void 0===this.enableHierarchy&&(this.enableHierarchy=!0),"boolean"==typeof a.enableHierarchy&&(this.enableHierarchy=a.enableHierarchy),this.user=this.user||{},"string"==typeof a.user?this.user.id=a.user:"object"==typeof a.user&&(this.user=this.merge(a.user)),"string"==typeof a.username&&(this.user.id=this.user.id||a.username),this.parent=this.parent||{},"string"==typeof a.account?this.account.id=a.account:"object"==typeof a.account&&("string"==typeof a.account.parent||"object"==typeof a.account.parent&&(this.parent=this.merge(a.account.parent,{}),delete a.account.parent),this.account=this.merge(a.account),this.enableHierarchy&&this.parent&&"string"==typeof this.parent.id&&this.track(null,null,this.merge(this.parent,{}),null,"parentAccountIdentification")),this.product=this.product||{},"string"==typeof a.product||"object"==typeof a.product&&(this.product=this.merge(a.product,{}),"string"==typeof a.product.account_id&&(this.product_account_id=a.product.account_id),delete this.product.account_id),this.product&&"string"==typeof this.product.id){var c=this.merge(this.product,{});delete c.id,c.product_id=this.product.id;var d=this.account;this.account=this.merge({id:this.account.id},c),this.parent&&"string"==typeof this.parent.id&&(d.parent_id=this.parent.id),this.enableHierarchy&&this.track(null,null,this.merge(d,{}),null,"accountIdentification")}}},this.track=function(a,b,c,d,e){var f=this._buildTrackParams(a,b,c,d,e);if(!f)return f;for(var g=this._buildSdrSrc(f),h=[this._sendPixel(f,g)],i=this._trackMirrors(f),j=0;j<i.length;j++)h.push(i[j]);return this.savecookie("totango.org_attributes","",0),this.savecookie("totango.user_attributes","",0),window.totangoSDRLog&&(this.__SDRLog=this.__SDRLog.concat(h)),h},this._buildTrackParams=function(a,b,c,d,e){var f=d;if("accountIdentification"===e||"parentAccountIdentification"===e)return this._buildSimpleAccountTrackParams(c);if(this.user=this.user||{},f=this.merge(f,this.user),f=this.merge(f,d),f=this.getUserObject(f),"string"==typeof d&&(f.id=d),!f.id)return null;var g=c;return"setAttributes"!==e&&(this.account=this.account||{},g=this.merge(g,this.account),g=this.merge(g,c),g=this.getAccount(g)),"string"==typeof c&&(g.id=c),g.id||this.allow_empty_accounts?(this.product&&"string"==typeof this.product.id?(this._addAccountAttribute("product_id",this.product.id,g),this.enableHierarchy&&this._addAccountAttribute("parent_id",this.account.id,g),this.product_account_id?g.id=this.product_account_id:g.id=this.account.id+"__"+this.product.id):this.enableHierarchy&&this.parent&&"string"==typeof this.parent.id&&this._addAccountAttribute("parent_id",this.parent.id,g),b=b||this.module,{service_id:this.service_id,region:this.region,account:g,user:f,activity:a,module:b}):null},this._addAccountAttribute=function(a,b,c){var d="sdr_o."+encodeURIComponent(a)+"="+encodeURIComponent(b);c.attributes?c.attributes.indexOf(d)===-1&&(c.attributes=c.attributes+"&"+d):c.attributes=d},this._buildSimpleAccountTrackParams=function(a){var b={id:a.id,fid:a.fid};delete a.id,delete a.fid;var c="";return a.name&&(c="sdr_odn="+encodeURIComponent(a.name),delete a.name),b.attributes=this.serialize("sdr_o.",a),c.length>0&&(b.attributes+=(b.attributes.length>0?"&":"")+c),{service_id:this.service_id,account:b}},this._buildSdrSrc=function(b){var c=[];return c.push("sdr_s="+b.service_id),b.account.id&&c.push("sdr_o="+encodeURIComponent(b.account.id)),b.account.fid&&c.push("sdr_ofid="+encodeURIComponent(b.account.fid)),b.user&&c.push("sdr_u="+encodeURIComponent(b.user.id)),b.activity&&c.push("sdr_a="+encodeURIComponent(b.activity)),b.module&&c.push("sdr_m="+encodeURIComponent(b.module)),b.account.name&&c.push("sdr_odn="+encodeURIComponent(b.account.name)),b.account.attributes&&c.push(b.account.attributes),b.user&&b.user.attributes&&c.push(b.user.attributes),c.push("sdrurl="+encodeURIComponent(document.location.href)),c.push("r="+Math.random()),b.module&&(c.push("sdr_heartbeat="+encodeURIComponent(a.heartbeat_timeout_sec)),c.push("sdr_heartbeat_idle="+encodeURIComponent(a.heartbeat_idle_timeout_sec))),c},this._trackMirrors=function(a){var b=this.mirror_services,c=[];if(!b)return[];for(var d=0;d<b.length;d++)c.push(this._sendMirrorPixel(a,b[d]));return c},this._sendMirrorPixel=function(a,b){var c,d=this.merge({},a),e={},f={};if(b&&b.service_id&&(d.service_id=b.service_id),b&&b.region&&(d.region=b.region),a.account&&(d.account=this.merge({},a.account),a.account.attributes&&(e=this.deserialize("sdr_o.",a.account.attributes))),b&&b.account){for(c in b.account)"id"===c||"name"===c?d.account[c]=b.account[c]:e[c]=b.account[c];d.account.attributes=this.serialize("sdr_o.",e),d.account.attributes&&0===d.account.attributes.length&&delete d.account.attributes}if(a.user&&(d.user=this.merge(a.user,b.user||{}),a.user&&a.user.attributes&&(f=this.deserialize("sdr_u.",a.user.attributes))),b&&b.user){for(c in b.user)"id"===c?d.user[c]=b.user[c]:f[c]=b.user[c];d.user.attributes=this.serialize("sdr_u.",f),d.user.attributes&&0===d.user.attributes.length&&delete d.user.attributes}return this._sendPixel(d,this._buildSdrSrc(d))},this._sendPixel=function(a,b){var c=new Image,d="https:"==document.location.protocol?"https://":"http://",e=a.region||"us";return c.src=d+this.hosts[e]+"/pixel.gif/?"+b.join("&"),c},this.identify=function(a,b){var c=this.getAccount(a),d=this.getUserObject(b);return this.user=this.merge({},d),this.account=this.merge({},c),this.account.attributes&&(this.account.attributes=this.deserialize("sdr_o.",this.account.attributes)),this.user.attributes&&(this.user.attributes=this.deserialize("sdr.u.",this.user.attributes)),this.savecookie("totango.org_name",c.id||"",1),this.savecookie("totango.user",d.id||"",1),this.savecookie("totango.org_dn",c.name||"",1),this.savecookie("totango.org_ofid",c.fid||"",1),null!=c.id&&null!=c.attributes&&""!=c.attributes?this.track(null,null,c,d):null!=c.attributes?(this.savecookie("totango.org_attributes",c.attributes||"",180),null):void 0},this.setAccountAttributes=function(a){this.clearAttributes();var b=this.getAccount(a);return null!=b.id&&null!=b.attributes&&""!=b.attributes?this.track(null,null,b,null,"setAttributes"):(this.savecookie("totango.org_attributes",b.attributes,1),null)},this.setUserAttributes=function(a,b){this.clearUserAttributes();var c=this.getUserObject(b),d=this.getAccount(a);return null!=c.id&&null!=c.attributes&&""!=c.attributes?this.track(null,null,d,c,"setAttributes"):(this.savecookie("totango.user_attributes",b.attributes,1),null)},this.getAccount=function(a){var e={id:{keys:["id","o"],func:function(a){return a.getOrg()}},fid:{keys:["fid","ofid"],func:function(a){return a.getOrgId()}},name:{keys:["name","odn"],func:function(a){return a.getOrgDisplayName()}},attributes:{keys:["attributes"],func:function(a){return null}}},f={};if(null!=a&&"object"==typeof a){a=d(a,e),a.attributes&&(a.attributes=this.deserialize("",a.attributes)),a=this.merge(this.account,a);for(var g in e){var h=e[g],i=b(a,h.keys)||h.func(this)||f[g];i&&(f[g]=i)}for(var j in a)c(j,e)||(f.attributes=f.attributes||{},f.attributes[j]=a[j])}else f.id=a||e.id.func(this);var k=this.getCookieAttributes();return f.attributes=this.merge(k,f.attributes),f.attributes=this.serialize("sdr_o.",f.attributes),f.attributes||delete f.attributes,f},this.serialize=function(a,b){var c=[];for(var d in b)c.push(encodeURIComponent(a+d)+"="+encodeURIComponent(b[d]));return c.join("&")},this.deserialize=function(a,b){if(!b)return{};if("object"==typeof b)return b;for(var c=b.split("&"),d={},e=0;e<c.length;e++){var f=c[e].split("="),g=decodeURIComponent(f[0]).substr(a.length);d[g]=decodeURIComponent(f[1])}return d},this.getCookieAttributes=function(){var a=this.readcookie("totango.org_attributes");return this.deserialize("sdr_o.",a)},this.getUserCookieAttributes=function(){var a=this.readcookie("totango.user_attributes");return this.deserialize("sdr_u.",a)},this.getOrgId=function(){return this.readcookie("totango.org_ofid")},this.getOrgDisplayName=function(){return this.readcookie("totango.org_dn")},this.getOrg=function(){return this.readcookie("totango.org_name")},this.getUserId=function(){var a;return this.user&&(a=this.user.id),a||this.readcookie("totango.user")},this.getUser=function(){return this.user.id||this.readcookie("totango.user")},this.getUserObject=function(a){var e={id:{keys:["id","u"],func:function(a){return a.getUserId()}},attributes:{keys:["attributes"],func:function(a){return null}}},f={};if(null!=a&&"object"==typeof a){a=d(a,e),a.attributes&&(a.attributes=this.deserialize("",a.attributes)),a=this.merge(this.user,a);for(var g in e){var h=e[g],i=b(a,h.keys)||h.func(this)||f[g];i&&(f[g]=i)}for(var j in a)c(j,e)||(f.attributes=f.attributes||{},f.attributes[j]=a[j])}else f.id=a||e.id.func(this);var k=this.getUserCookieAttributes();return f.attributes=this.merge(k,f.attributes),f.attributes=this.serialize("sdr_u.",f.attributes),f.attributes||delete f.attributes,f},this.savecookie=function(a,b,c){var d=new Date;d.setTime(d.getTime()+24*("undefined"!=typeof c?c:3)*60*60*1e3);var e="; expires="+d.toGMTString(),f=a+"="+b+e+"; path=/";"https:"==document.location.protocol&&(f+="; secure"),document.cookie=f},this.readcookie=function(a){var b=new RegExp("(?:^| )"+a+"=([^;]*)","i"),c=document.cookie.match(b);return c&&2==c.length?c[1]:null},this.clearAttributes=function(){this.savecookie("totango.org_attributes","",0),this.account&&delete this.account.attributes},this.clearUserAttributes=function(){this.savecookie("totango.user_attributes","",0),this.user&&delete this.user.attributes},this.clear=function(){this.clearAttributes(),this.clearUserAttributes(),this.savecookie("totango.org_dn","",0),this.savecookie("totango.org_name","",0),this.savecookie("totango.org_ofid","",0),this.savecookie("totango.user","",0),this.savecookie("totango.heartbeat.last_module","",0),this.savecookie("totango.heartbeat.last_ts","",0)},this.heartbeat=function(){var a;if(this.heartbeat_timeout_ms>0){var b=this.module||"__system",c=this.readcookie("totango.heartbeat.last_module"),d=this.readcookie("totango.heartbeat.last_ts");if(c&&c==b&&Date.now()-new Date(d).valueOf()<6e4)return null;if(this.isIdle())return null;a=this.track("__heartbeat",this.module||"__system"),this.savecookie("totango.heartbeat.last_module",b),this.savecookie("totango.heartbeat.last_ts",Date.now());var e=this;window.__totangoTrackTimer=setTimeout(function(){e.heartbeat()},this.heartbeat_timeout_ms)}return a},this.startTracking=function(){window.__totangoTrackTimer||(this.lastUserInteraction=Date.now(),this.heartbeat_timeout_ms>0&&this.attachListeners()),this.heartbeat()},this.attachListeners=function(){var a=this,b=function(){a.onUserInteraction()};this.addEvent(document,"keyup",b),this.addEvent(document,"mousemove",b),this.addEvent(document,"click",b),this.addEvent(window,"scroll",b)},this.addEvent=function(){var a;return function(b,c,d){a||(a=b.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:b.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a["on"+b]=c}),a(b,c,d)}}(),this.isIdle=function(){return Date.now()-this.lastUserInteraction>this.heartbeat_idle_timeout_ms},this.onUserInteraction=function(){var a=this.isIdle();this.lastUserInteraction=Date.now(),a&&this.heartbeat()},this.merge=function(a,b){var c={};return this.extend(c,a),this.extend(c,b),c},this.extend=function(a,b){for(var c in b)null===b[c]?a[c]="":"object"==typeof b[c]?("object"!=typeof a[c]&&(a[c]={}),this.extend(a[c],b[c])):b.hasOwnProperty(c)&&(a[c]=b[c])},this.go=function(a){return this.setOptions(a),this.user.id?(this.startTracking(),1):-2},this.go(a)}if(window.totango_options){var tracker_name=window.totango_options.tracker_name||"totango";if(window[tracker_name]&&window[tracker_name].version)console.warn("Totango: You cannot instantiate Totango more than once.");else{if(window[tracker_name]=new __totango(window.totango_options),window.totango_tmp_stack&&window.totango_tmp_stack.length>0)for(var i=0;i<window.totango_tmp_stack.length;i++){var item=window.totango_tmp_stack[i],activity=item.activity,module=item.module,org=item.org,user=item.user;window[tracker_name].track(activity,module,org,user)}delete window.totango_tmp_stack}}else console.warn("Totango: Totango options are missing.");